---
title: "Divvy_Dashboard"
author: "Zack Larsen"
date: "8/25/2019"
output: 
  flexdashboard::flex_dashboard:
    theme: "journal"
    social: [ "menu" ]
    navbar:
      - { title: "About Me", href: "https://zacklarsen.github.io/" , align: right}
      - { icon: "fa-github", href: "https://github.com/ZackLarsen" , align: right}
      - { icon: "fa-linkedin", href: "https://www.linkedin.com/in/larsenzachary/", align: right}
    source: embed
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(pacman)
library(plotly)
library(magrittr)

p_load(leaflet, leaflet.extras, flexdashboard, ggplot2, 
       data.table, glue, DT, kableExtra, ggvis, here, 
       conflicted, data.table, jsonlite, geojsonio, geosphere, 
       networkD3, htmltools, treemap, highcharter, viridisLite,
       ggmap, ggthemes, rbokeh, data.tree, ggraph, 
       circlepackeR, viridis, patchwork, ggraph, RColorBrewer,
       collapsibleTree, scales)

conflict_prefer("here", "here")

trips <- fread(here('data','trips.csv'), nrows = 1000)

stations <- fread(here('data','stations.csv'))

trips_with_stations <- merge(trips, stations, by.x = 'from_station_id', by.y = 'station_id')



# ward_boundaries <- geojsonio::geojson_read(file.path(chi_data,"Boundaries_Wards.geojson"), what = "sp")


```


Landing Page - Divvy Data
=========================================

Column 
-------------------------------------

### Divvy stations, plotted using leaflet. This map can be zoomed in on interactively and the station names will be displayed upon hovering over the icon.


```{r landing_map, cache=TRUE, eval=TRUE, echo=FALSE, warning=FALSE}

stations_popup <- stations %>% 
  mutate(
    popup_text = paste(
      sep = "<br/>",
      glue("<b><a>{name}</a></b>"),
      glue('Capacity: ',"<b><a>{capacity}</a></b>"),
      paste(lat, lon, sep=', ')
    )
  )

my_map <- leaflet(stations_popup) %>%
  addTiles() %>%
  addMarkers(lat = stations_popup$lat,
             lng = stations_popup$lon,
             label = lapply(stations_popup$popup_text, HTML)
             )
my_map

```

Column {.tabset}
-------------------------------------
   
### Trips

```{r, cache=TRUE, eval=TRUE, echo=FALSE}

trips %>% 
  select(start_time, end_time, bikeid, tripduration) %>% 
  head(n=20) %>% 
  kable() %>% 
  kable_styling()

```   


### Trips greater than 10 minutes
    
```{r, cache=TRUE, eval=TRUE, echo=FALSE}

trips %>% 
  select(trip_id, start_time, end_time, tripduration) %>% 
  filter(tripduration >= 10 * 60) %>% 
  mutate(duration_in_minutes = tripduration / 60) %>% 
  arrange(desc(duration_in_minutes)) %>% 
  head(n=20) %>% 
  kable() %>% 
  kable_styling()

```


### Trips on Michigan Avenue
    
```{r, cache=TRUE, eval=TRUE, echo=FALSE}

stations %>% 
  filter(grepl("Michigan", name)) %>% 
  arrange() %>% 
  head(n=20) %>% 
  kable() %>% 
  kable_styling()

```


### Stations in Evanston
    
```{r, cache=TRUE, eval=TRUE, echo=FALSE}

stations %>% 
  filter(region == 'Evanston') %>% 
  arrange() %>% 
  head(n=20) %>% 
  kable() %>% 
  kable_styling()

```


Heatmaps {.storyboard data-commentary-width=200 data-navmenu="Traditional"} 
=========================================

These visualizations convey information about the density of certain data points geographically.


### Heatmaps

```{r, cache=TRUE, eval=TRUE}

leaflet(trips_with_stations) %>%
  addTiles() %>% 
  addHeatmap(lng=~lon,
             lat=~lat,
             radius = 8)

```


Other {.storyboard data-commentary-width=200 data-navmenu="Other"} 
=========================================

These visualizations convey information about trips and riders.


### Histogram

```{r histogram, cache=TRUE, warning=FALSE, message=FALSE}

ggplot(trips, aes(start.hour)) +
  geom_bar(fill = "dodgerblue",width = 0.6) +
  theme_minimal() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

```

